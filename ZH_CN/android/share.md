#MSDK分享模块

## 概述

该模块将会对MSDK所有分享相关的模块做一次梳理，包括每类分享的分享方法、使用场景、分享效果、点击效果、注意事项已经调用的接口说明。游戏可以先参照本文的描述熟悉MSDK所有分享相关的接口，然后根据游戏自己的需要使用对应的分享接口来达到玩家之间互动的目的。

## MSDK 推荐用法

MSDK根据游戏常用的开发常见，给出了各种场景下推荐使用的分享消息的类型。游戏可以参照MSDK的推荐用法实现自己的功能。

- **好友邀请（包括但不限于邀请注册）**：结构化消息、音乐消息
- **游戏同玩好友间的邀请（例如邀请进入指定房间等）**：结构化消息、音乐消息、后端分享
- **送心后通知好友或者游戏内通知好友**：后端分享
- **游戏内成就炫耀**：纯图消息或者结构化消息
- **游戏官网相关的活动分享**：链接消息、结构化消息

`注意，由于手Q客户端部分的版本返回的回调是有问题的, 故建议不要依赖分享回调做较重的游戏逻辑(如，分享成功赠送道具等).`

## 各种分享类消息对比

### 消息分享的异同简单对比

| 分享类型 | 分享位置 |能否分享给非同玩好友 | 是否需要拉起客户端 | 调用接口 | 详细说明 |
|: ----- :|: ----- :|: ----- :|: ----- :|: ----- :|: ----- :|: ----- :|
| QQ结构化消息分享 		| 会话/空间 	| 能 | 需要   | WGSendToQQ           | [点击查看](qq.md#结构化消息分享)|
| 微信结构化消息分享 	| 会话 			| 能 | 需要   | WGSendToWX           | [点击查看](wechat.md#结构化消息分享)|
| 微信链接消息分享 		| 会话/朋友圈 	| 能 | 需要   | WGSendToWeixinWithUrl| [点击查看](wechat.md#链接分享)|
| QQ音乐消息分享 		| 会话/空间 	| 能 | 需要   | WGSendToQQWithMusic  | [点击查看](qq.md#音乐消息分享)|
| 微信音乐消息分享 		| 会话/朋友圈	| 能 | 需要   | WGSendToWXWithMusic  | [点击查看](wechat.md#音乐消息分享)|
| QQ纯图分享 			| 会话/空间 	| 能 | 需要   | WGSendToQQWithPhoto  | [点击查看](qq.md#大图消息分享)|
| 微信纯图分享 			| 会话/朋友圈 	| 能 | 需要   | WGSendToWXWithPhoto, WGSendToWXWithPhotoPath  | [点击查看](wechat.md#大图消息分享)|
| QQ后端分享 			| QQ手公共号	| 否 | 不需要 | WGSendToQQGameFriend | [点击查看](qq.md#后端分享)|
| 微信后端分享 			| 会话 			| 否 | 不需要 | WGSendToWXGameFriend | [点击查看](wechat.md#后端分享)|
| 微信分享到游戏中心    | 微信游戏中心  | 否 | 不需要 | WGSendMessageToWechatGameCenter | [点击查看](wechat.md#分享到游戏中心)|

### 分享消息点击效果

这里仅列出所有分享消息共有的特性和点击效果，具体的差异可以参考下方的说明文档。

![分享效果示例](./share_demo.png "分享效果示例")

### 手Q

1. 点击分享消息中的`小尾巴`会拉起游戏，这种情况拉起`不带任何信息`，因此`收不到异帐号`的判断结果，也即**`无法也不用做异账号处理`**。
* **手Q的部分接口参数中含有跳转链接，游戏可以按照下面的逻辑添加跳转链接**：
	1. 通过PR2评审的游戏
		- 链接配置：可以将跳转链接设置为手Q游戏中心的游戏详情页（详见[游戏中心详情页](qq.md#游戏中心详情页)）
		- 对应情况：通过在游戏中心的不同配置可以实现带票据拉起游戏或者不带票据拉起游戏（[配置方法查看QQ快速登录](qq.md#快速登录)）

	2. 没有通过PR2评审的游戏
		- 链接配置：可以将跳转链接设置为应用宝详情页（具体可以咨询应用宝vivianhui）
		- 对应情况：可以拉起游戏或者下载游戏

	3. 即没有通过PR2又不接应用宝的游戏
		- 链接配置：跳转链接只能设置为其他链接
		- 对应情况：点击消息会跳转到对应的网址，游戏可以在网址自己做游戏的下载或者web拉起
* **关于手Q游戏中心详情页**：手Q游戏中心详情页是手Q提供给的一个手Q游戏中心链接。当带跳转消息分享的目标地址填写该链接时，点击消息可以跳转到该目标链接并可以带参数拉起游戏实现快速登陆（相当于在游戏中心点启动按钮）。手Q游戏中心的具体使用、配置方法可以参考：[游戏中心详情页](qq.md#游戏中心详情页)

### 微信

* 点击分享消息的消息体可拉起游戏（需要运营经理配置），点击小尾巴可进入游戏官网(需要运营经理配置)。
* 微信不支持快速登录，即从微信拉起游戏时，游戏可以收到异账号的判断结果，但无法用拉起的账号登录授权。

## 结构化消息分享

### 使用场景：

由于结构化消息可以发送给任意平台好友，而且点击结构化消息可以带参数拉起游戏，因此结构化消息一般多用于邀请、炫耀。

### 分享效果：

![结构化消息](./share_res/share_structure.png "结构化消息")

### 点击效果：

#### 手Q

* 点击分享消息中消息体时，会跳转到targetUrl（调用接口时的参数）。如果targetUrl设置为游戏对应游戏中心详情页url（由运营经理提供）可拉起游戏并根据在游戏中心的配置可以携带票据，直接用拉起的账号登录授权。

### 注意事项：

1. 手Q的空间的缩略图建议大小为200*200，过小或过大的图片可能无法显示。
2. 微信的结构化消息不能分享到朋友圈，只能分享给好友，且缩略图不超过32K。
3. 从微信拉起游戏只有openid，需要重新微信登录授权才能用拉起的账号登录游戏。

### 接口说明：

- 手Q结构化消息：点击查看[WGSendToQQ](qq.md#结构化消息分享)接口说明
- 微信结构化消息：点击查看[WGSendToWeixin](wechat.md#结构化消息分享)接口说明

## 链接消息分享

链接消息其实是结构化消息的一种，由于微信结构化消息不支持点击结构体跳转制定链接，因此增加了链接消息。链接同样消息可以发送给任意好友，而且点击结构体可以打开链接。因此链接消息一般多用于邀请、炫耀、活动页面分享等。

### 分享效果：

![链接消息](./share_res/share_wx_url.png "链接消息")

### 点击效果：

点击消息会在微信中打开传入`WGSendToWeixinWithUrl`接口中`url`参数指定的网址。

### 接口说明：

* 链接消息分享：点击查看[WGSendToWeixinWithUrl](wechat.md#链接分享)接口说明

##音乐消息分享

音乐消息与结构化消息展示形式类似，点击分享的消息可直接在手Q或微信内播放音乐，一般用于分享游戏音乐。

### 分享效果：

![音乐消息](./share_res/share_qq_music.png "音乐消息")
![音乐消息](./share_res/share_wx_music.png "音乐消息")

### 点击效果

#### 手Q

* 在**手Q会话**中，点击音乐消息的图标会直接播放音乐，点击音乐消息中图标的右侧结构体会打开传入`WGSendToQQWithMusic`接口中`musicUrl`对应的网址。
* 在**手Q空间**中，点击音乐消息的图标会跳转到`musicUrl`参数指定的网址，点击音乐消息中图标的右侧区域会打开此条消息的详情页。

#### 微信

* 点击音乐消息中的图标，微信会直接播放音乐。点击音乐消息中图标的右侧区域会打开传入`WGSendToWXWithMusic`接口中`musicUrl`参数指定的网址。

### 注意事项：

1. 手Q的空间的缩略图建议大小为200*200，过小或过大的图片可能无法显示。
2. 微信音乐分享需要使用本地图片。

### 接口说明：

* 手Q音乐消息：点击查看[WGSendToQQWithMusic](qq.md#音乐消息分享)接口说明
* 微信音乐消息：点击查看[WGSendToWXWithMusic](wechat.md#音乐消息分享)接口说明

## 纯图消息分享

纯图消息又名大图消息，整个消息为一张图片，故常用于战绩、成就等炫耀分享。

### 分享效果：

![纯图消息](./share_res/share_qq_photo.png "纯图消息")
![纯图消息](./share_res/share_wx_photo.png "纯图消息")

### 点击效果

- 点击纯图消息的图片会展示原始图片。

### 注意事项：

1. 微信图片数据使用安卓系统的binder传递，因此图片大小有限制，过大会导致分享失败。
    A) WGSendToWeixinWithPhoto，使用此接口分享图片数据应小于1MB。
    B) WGSendToWeixinWithPhotoPath，使用此接口分享建议图片小于3MB。
2. 纯图分享使用的是本地图片，要将图片存放于第三方应用有权限可读取到的位置，如sdcard分区。

### 接口说明：

* 手Q纯图消息：点击查看[WGSendToQQWithPhoto](qq.md#大图消息分享)接口说明
* 微信纯图消息：
A) 点击查看[WGSendToWXWithPhoto](wechat.md#大图消息分享)接口说明
B) 点击查看[WGSendToWeixinWithPhotoPath](wechat.md#大图消息分享)接口说明

## 后端分享

后端分享不需要拉起手Q或微信，并只能分享给同玩好友(共同玩一个游戏的好友)，因此后端分享常用于送心，也可用于邀请、炫耀等。

### 分享效果：

![后端分享](./share_res/share_back.png "后端分享")

### 点击效果

#### 手Q

手Q后端分享给好友的消息位于**“QQ手游”**服务号中。

* 点击分享消息会直接拉起游戏，行为和点击小尾巴类似。

#### 微信

后端分享到会话的消息位于好友的聊天记录中。

* 后端分享到会话，点击分享的消息能直接拉起游戏。

### 注意事项：

1. 手Q后端分享消息在PC版QQ、海外版QQ上均不显示。手机QQ的后端消息会统一发送到手机QQ的“QQ手游”服务号，因此接收方需要关注该服务号（默认关注）才能接收到，同一用户同一天收到的同一款游戏能接收的在20条消息左右。
2. 微信对后端分享的频率限制是针对单款游戏单个用户做限制。

### 接口说明：

* 手Q后端分享：点击查看[WGSendToQQGameFriend](qq.md#后端分享)接口说明
* 微信后端分享：点击查看[WGSendToWXGameFriend](wechat.md#后端分享)接口说明

## 分享到游戏中心

微信登录后可在不拉起微信的情况下分享消息到微信游戏中心。这种消息主要包含两部分，消息体和附加按钮，消息体主要包含展示内容附加按钮主要定义了点击以后的跳转动作（拉起APP，拉起页面、拉起排行榜）。可在游戏中心的我的消息中查看。

### 分享效果

![分享到游戏中心](./share_wx_center.png "分享到游戏中心")

### 点击效果

#### 消息体

* 文本消息：消息体点击无效果
* 图片消息：点击消息体显示原图
* 视频消息：点击消息体播放视频或系统弹框让用户选择使用相应APP打开
* 链接消息：点击消息体打开相应的网页

#### 附加按钮

* 拉起应用：点击按钮能够拉起游戏
* 拉起web页面：点击按钮打开相应的网页
* 拉起排行榜：点击按钮拉起游戏在微信游戏中心的详情页

### 注意事项：

1. 点击 跳转排行榜 按钮会先跳转到此游戏详情页，用户可在此游戏详情页查看排行榜。且 ButtonRankView 中的 title, rankViewButtonName 无效，界面不会展示这两个参数。

### 接口说明：

* 微信分享到游戏中心：点击查看[WGSendMessageToWechatGameCenter](wechat.md#分享到游戏中心)接口说明